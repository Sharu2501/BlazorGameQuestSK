@namespace BlazorGame.Client.Pages
@page "/game"

<link rel="stylesheet" href="css/room.css" />
<link rel="stylesheet" href="css/game.css" />

@if (isLoading)
{
    <div class="loading-container">
        <div class="loading-content">
            <img src="images/logo.png" class="loading-logo" />
            <p class="loading-text">Génération du donjon...</p>
        </div>
    </div>
}

else if (gameState != null)
{
    <div class="salle-container" style="background-image: url('@GetRoomImage()')">
        <div class="salle-content">
            <img src="images/logo.png" class="room-logo" />

            <div class="dungeon-info">
                <h2>@gameState.CurrentDungeon?.Name</h2>
                <p class="dungeon-desc">@gameState.CurrentDungeon?.Description</p>
                <p>Salle @(gameState.CurrentRoomIndex + 1) / @gameState.TotalRooms - @gameState.CurrentRoom?.Name</p>
                <p>Difficulté: @GetDifficultyName(gameState.DifficultyLevel)</p>
            </div>

            <div class="battle-container">
                <div class="player-stats-side">
                    <h4 style="color:rgb(25, 90, 143);"> <img src="images/ninja.svg" class="stat-icon" /> @PlayerStats?.Username</h4>
                    <div class="stats-box green-bg">
                        <div class="stat-item"> <img src="images/coeur.svg" class="stat-icon" /> PV: @PlayerStats?.Health / @PlayerStats?.MaxHealth</div>
                        <div class="stat-item"> <img src="images/epees.svg" class="stat-icon" /> ATQ: @PlayerStats?.Attack</div>
                        <div class="stat-item"> <img src="images/bouclier.svg" class="stat-icon" /> DEF: @PlayerStats?.Defense</div>
                        <div class="stat-item"> <img src="images/lingots-dor.svg" class="stat-icon" /> Or: @PlayerStats?.Gold</div>
                        <div class="stat-item"> <img src="images/niveau-superieur.svg" class="stat-icon" /> Niveau: @PlayerStats?.Level</div>
                    </div>
                </div>

                <div class="battle-messages">
                    <div class="battle-message">@message</div>
                </div>

                @if (gameState.CurrentRoom?.Monster != null)
                {
                    <div class="monster-stats-side">
                        <h4 style="color:#fc4343;"> <img src="images/monstre.svg" class="stat-icon" /> @gameState.CurrentRoom.Monster.Name</h4>
                        <div class="stats-box red-bg">
                            <div class="stat-item"> <img src="images/coeur.svg" class="stat-icon" /> PV: @gameState.CurrentRoom.Monster.Health</div>
                            <div class="stat-item"> <img src="images/epees.svg" class="stat-icon" /> ATQ: @gameState.CurrentRoom.Monster.Attack</div>
                            <div class="stat-item"> <img src="images/bouclier.svg" class="stat-icon" /> DEF: @gameState.CurrentRoom.Monster.Defense</div>
                            <div class="stat-item"> <img src="images/niveau-superieur.svg" class="stat-icon" /> Niveau: @gameState.CurrentRoom.Monster.Level</div>
                        </div>
                    </div>
                }
            </div>

            <div class="actions">
                @foreach (var action in GetAvailableActions())
                {
                    <button @onclick="@(() => ExecuteAction(action))" disabled="@IsActionDisabled(action)">@action</button>
                }
            </div>

            <div class="heal-potions">
                <span>Potions de soin : </span>
                @for (int i = 0; i < gameState.MaxHealPerRoom; i++)
                {
                    @if (i < gameState.HealUsedInRoom)
                    {
                        <img src="images/potion.svg" alt="Potion utilisée" class="potion-used" />
                    }
                    else
                    {
                        <img src="images/potion.svg" alt="Potion disponible" class="potion-available" />
                    }
                }
            </div>
        </div>

        <div class="pause-container">
            <div class="pause-modal-buttons">
                <button @onclick="PauseGame">Pause</button>
            </div>
        </div>

        @if (showPausePopup)
        {
            <div class="pause-modal-backdrop">
                <div class="pause-modal">
                    <h3>Jeu en pause</h3>
                    <div class="pause-modal-buttons">
                        <button class="game-button" @onclick="ResumeGame">Reprendre le jeu</button>
                        <button class="game-button" @onclick="@(() => NavigationManager.NavigateTo("/home"))">Accueil</button>
                    </div>
                </div>
            </div>
        }

    </div>
}